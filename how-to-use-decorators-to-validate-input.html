<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>How to Use Decorators to Validate Input</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">My Test Website </a></h1>
                <nav><ul>
                    <li><a href="/category/base-category.html">Base Category</a></li>
                    <li class="active"><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/how-to-use-decorators-to-validate-input.html" rel="bookmark"
           title="Permalink to How to Use Decorators to Validate Input">How to Use Decorators to Validate Input</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-05-04T11:40:40.490376+02:00">
                Published: vr 04 mei 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/aquiles-carattino.html">Aquiles Carattino</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>

</footer><!-- /.post-info -->      <p>Python is rich in resources that can shorten the time it takes to develop new programs and simplify repetitive tasks. Decorators are one of such elements but more often than not they are not considered by less experienced developers. Adding decorators to the syntactic toolbox can be of great use in different contexts, and in this article, we are going to discuss how can they help you when communicating with a device. The example code can be found in our <a class="reference external" href="https://github.com/uetke/website_content/tree/master/example_code/Examples_Decorators">Github repository</a>.</p>
<p>Decorators in Python are nothing more than functions that take as arguments other functions. They appear with an <tt class="docutils literal">&#64;</tt> in front of them right above a function (or a method within a class). Let's quickly recap how functions work in Python and how to use them. Imagine you want to compute the average of two values. We can develop a function for it:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
   <span class="k">return</span> <span class="n">avg</span>
</pre></div>
<p>We can use the function directly in our code by writing:</p>
<div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
<p>What you should see happening is that when you call the function <tt class="docutils literal">average</tt> it adds both numbers and returns their mean value. Imagine that, for some reason, you want to allow only positive numbers as arguments of your function. You can expand the <tt class="docutils literal">average</tt> function to check whether it is true or not.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Both x and y have to be positive&quot;</span><span class="p">)</span>

   <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
   <span class="k">return</span> <span class="n">avg</span>
</pre></div>
<p>Every time someone wants to use the function with a negative argument, an error will be raised. Later, we are asked to develop a new function to compute the geometric average of two numbers, and we need them both to be positive. Our function will look like this:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">geom_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Both x and y have to be positive&quot;</span><span class="p">)</span>

   <span class="n">avg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">avg</span>
</pre></div>
<p>There is a general rule of thumb that says that code shouldn't be copied more than twice. If you are going to copy-paste code for the third time there is probably a better way of doing it. In the examples above, you can see that the verification of the input is exactly the same in both functions. If we were to write a third function, we would meet the three-copies rule. It would be useful to have an external way of checking that both inputs are positive, and this is exactly what decorators are meant to do.</p>
<div class="section" id="functions-as-arguments-and-as-outputs-of-other-functions">
<h2>Functions as arguments and as outputs of other functions</h2>
<p>Before we can go into the details of how to use <tt class="docutils literal">decorators</tt> in Python, it is important to show how functions work with inputs and outputs that are other functions. For example, we could define a function that transforms the output of the averages defined above into integers. It is a very simplistic example but already shows the pattern that you can follow to achieve more complex behaviors.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">integer_output</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
   <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
<p>In the code above, you can see that <tt class="docutils literal">integer_output</tt> takes three arguments, a function <tt class="docutils literal">func</tt> and two numbers, <tt class="docutils literal">x</tt> and <tt class="docutils literal">y</tt> . We use the function, regardless of what it is, with arguments <tt class="docutils literal">x</tt> and <tt class="docutils literal">y</tt>. It then returns the result of <tt class="docutils literal">func</tt> converted to an integer value. <tt class="docutils literal">integer_output</tt> can be used like this:</p>
<div class="highlight"><pre><span></span><span class="n">rounded</span> <span class="o">=</span> <span class="n">integer_output</span><span class="p">(</span><span class="n">average</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
<span class="n">geom_rounded</span> <span class="o">=</span> <span class="n">integer_output</span><span class="p">(</span><span class="n">geom_average</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">geom_rounded</span><span class="p">)</span>
</pre></div>
<p>It is important to note that the first argument is a function and it doesn't matter which one. You could use <tt class="docutils literal">average</tt> or <tt class="docutils literal">geom_average</tt>. The next two arguments are going to be passed directly to <tt class="docutils literal">func</tt> . This is already quite powerful and most likely you can think a lot of ways in which you can use it, but Python allows you to do even more interesting things.</p>
<p>Functions can also be defined within functions and you can use them based on your input arguments. For example, let's assume you want to use <tt class="docutils literal">average</tt> only if the sum of x and y is even and the <tt class="docutils literal">geom_average</tt> if the sum is odd:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">even_odd_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
   <span class="k">def</span> <span class="nf">geom_average</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">geom_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
<p>The function <tt class="docutils literal">even_odd_average</tt> takes only two arguments on which it is going to perform the average. Inside we define two functions, exactly as we did earlier, <tt class="docutils literal">average</tt> and <tt class="docutils literal">geom_average</tt>, but this time they are available only within the <tt class="docutils literal">even_odd_average</tt> function. Based on the input from the user, we either calculate the average or the geometric average as requested earlier and we return the value. We can use this function as:</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">even_odd_average</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">even_odd_average</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>
<p>So far, we have seen how to use functions as arguments in other functions and how to define functions within functions. The only missing part is to be able to return a function instead of a value. Let's assume you want to print the time it takes to calculate the average between two numbers, but you don't want to re-write your original function. We have to write a function wrapper.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">timing_average</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
      <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;It took {} seconds to calculate the average&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">res</span>

   <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
<p>We start by defining a function that takes as an argument another function. We also define a new function called <tt class="docutils literal">wrapper</tt> as we explained earlier. So far, both steps were done in the previous examples, but now we are going to use <tt class="docutils literal">func</tt> within the <tt class="docutils literal">wrapper</tt>. We start by storing the current time at the variable <tt class="docutils literal">t0</tt>. We execute the function <tt class="docutils literal">func</tt> with the arguments <tt class="docutils literal">x</tt> and <tt class="docutils literal">y</tt> and store the new time at <tt class="docutils literal">t1</tt>. We print the total time it took to run the function and return the output of <tt class="docutils literal">func</tt>. The important part here is the very last line. As you can see, we are not returning the value that <tt class="docutils literal">func</tt> returns, but we are actually returning the <tt class="docutils literal">wrapper</tt>, which is in itself a function. To see this in action, we can do the following:</p>
<div class="highlight"><pre><span></span><span class="n">new</span> <span class="o">=</span> <span class="n">timing_average</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>
<span class="n">new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
<p>What you see in the above code is that we create a function called <tt class="docutils literal">new</tt> by using <tt class="docutils literal">timing_average</tt> with only one argument, the function <tt class="docutils literal">average</tt>. <tt class="docutils literal">New</tt> will take the same inputs that the <tt class="docutils literal">wrapper</tt> function takes. If we use <tt class="docutils literal">new</tt> as a function, with arguments <tt class="docutils literal">2</tt> and <tt class="docutils literal">4</tt> , you will see that it prints to screen the total time it took to calculate the average. <tt class="docutils literal">new</tt> is nothing more than the function <tt class="docutils literal">wrapper</tt>, defined using <tt class="docutils literal">average</tt>. We could do the same using <tt class="docutils literal">geom_average</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">new_geom</span> <span class="o">=</span> <span class="n">timing_average</span><span class="p">(</span><span class="n">geom_average</span><span class="p">)</span>
<span class="n">new_geom</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
<p>The syntax above can be hard to understand and forces you to define new functions to add timing capabilities. When you see that you are assigning the output of <tt class="docutils literal">timing_average</tt> to a variable called <tt class="docutils literal">new</tt> you don't expect it to actually be a function. If you already have working code, you need to do a lot of refactoring in order to define and use the new functions.</p>
<p>Fortunately, Python offers a very clear and simple way of achieving the same functionality, without the downsides just said. If you managed to follow the above examples, you are ready to improve the way the code looks like by using <em>Python syntactic sugar</em>.</p>
</div>
<div class="section" id="syntactic-sugar-for-decorators">
<h2>Syntactic Sugar for Decorators</h2>
<p>You already know almost everything there is to know regarding how to use decorators, you are just missing the syntactic sugar of Python. With what you have already done, you can improve the style of your code quite easily. Assuming you want to add timing capabilities to your average or geometrical average function, you can simply do:</p>
<div class="highlight"><pre><span></span><span class="nd">@timing_average</span>
<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
<p>By simply adding <tt class="docutils literal">&#64;timing_average</tt> before your function, you are now able to use <tt class="docutils literal">average</tt> as always, but printing the time it takes to calculate it. The obvious advantage of this syntax is that it allows you to add an interesting new functionality without altering your downstream code. You don't need to define a new function, you only need to add one line of code before the definition of your <tt class="docutils literal">average</tt>. It runs as always:</p>
<div class="highlight"><pre><span></span><span class="n">avg</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;The average between 4 and 6 is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">avg</span><span class="p">))</span>
</pre></div>
<p>Coming back to the examples of the averages that take only positive arguments, and building on the example of <tt class="docutils literal">timing_average</tt>, we can develop a wrapper function that would check whether the input of our function is positive or not.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_positive</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Both x and y have to be positive for function {} to work&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">res</span>
   <span class="k">return</span> <span class="n">func_wrapper</span>
</pre></div>
<p>The structure of <tt class="docutils literal">check_positive</tt> is very similar to what we have done for the timing. The only difference is that we check the input arguments and we raise an <tt class="docutils literal">Exception</tt> if they are not both positive. Since we are raising an exception for an unknown function, it becomes handy to display which function actually gave the error. We achieve that by using <tt class="docutils literal">func.__name__</tt>, which will tell us the name of the function. The rest is exactly the same as with the timing example. We can write our average functions as follows:</p>
<div class="highlight"><pre><span></span><span class="nd">@check_positive</span>
<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="nd">@check_positive</span>
<span class="k">def</span> <span class="nf">geom_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
</pre></div>
<p>Both functions, <tt class="docutils literal">average</tt> and <tt class="docutils literal">geom_average</tt> don't change their names, therefore you can use them as always, but they will check for positive input before computing the average:</p>
<div class="highlight"><pre><span></span><span class="n">average</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">average</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">geom_average</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">geom_average</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
<p>Decorators can also be combined, you can time a function AND request the inputs to be positive:</p>
<div class="highlight"><pre><span></span><span class="nd">@timing_average</span>
<span class="nd">@check_positive</span>
<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</pre></div>
<p>You can play around and see what happens if you change the order of the decorators. Importantly, if you use <tt class="docutils literal">func.__name__</tt> to print the name of the function that raised the <tt class="docutils literal">Exception</tt> within a decorator, you can see that the name can change and become the name of the wrapper. In most cases this is not a desired situation because you won't be able to debug what is the real function giving troubles, you will just get the name of the decorator. However, this is a more subtle topic that will be covered in the future.</p>
<p>One of the advantages of decorators is that even if a developer doesn't fully understand what it is happening under the hood, it will for sure understand how to use them and what to expect. If you provide good examples in your code it will become apparent where and when to include specific decorators. Now that you have a basic understanding of what the <tt class="docutils literal">&#64;</tt> means in Python you can start thinking about many more interesting applications.</p>
<p>In this article, we have shown a couple of very basic examples that can be greatly improved. If you have ever encountered decorators and didn't understand how to use them, or you are looking for more specific information, leave your message in the comment section below and we will use your feedback to write a follow up article specifically designed to answer your questions.</p>
</div>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>